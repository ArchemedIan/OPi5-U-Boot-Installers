CONFIG_BOOTCOMMAND=|
echo '"SPI Installer: bootorder will be ${SpiInstbootorder}"'; 
echo '"SPI Installer: board should be ${SpiInstboardname}"'; 
echo '"SPI Installer: u-boot ref is ${SpiInstref}"'; 
echo '"SPI Installer: look for SPI Installer root"'; 
env set SpiInstDevType '"NotFound"'; 
for thisdevtype in sd usb ; do 
if test '${SpiInstDevType}' = '"NotFound"'; then 
	if test -e '${thisdevtype}' 0#SpiInst '"u-boot-${SpiInstref}-${SpiInstboardname}-spi__${SpiInstbootorder}.bin"'; then 
		env set SpiInstDevType '"${thisdevtype}"'; 
		echo '"SPI Installer: found SPI Installer root on ${SpiInstDevType}"'; 
	fi; 
fi; 
done; 

if test '${SpiInstRootFound}' = '"NotFound"'; then 
	echo '"couldnt find SPI installer root"'; 
else;
	echo '"SPI Installer: attempt to load u-boot-${SpiInstref}-${SpiInstboardname}-spi__${SpiInstbootorder}.bin"'; 
	if load '${SpiInstDevType}' 0#SpiInst '"${loadaddr}"' '"u-boot-${SpiInstref}-${SpiInstboardname}-spi__${SpiInstbootorder}.bin"'; 
		echo '"SPI Installer: loaded. attempt to install u-boot-${SpiInstref}-${SpiInstboardname}-spi__${SpiInstbootorder}.bin"';
		if sf update '"${loadaddr}"' 0 '"${filesize}"'; then 
			echo '"SPI Installer: spi u-boot install success"';
			fatmkdir '${SpiInstDevType}' 0#SpiInst success; 
			fatwrite '${SpiInstDevType}' 0#SpiInst '"${loadaddr}"' '"success/u-boot-${SpiInstref}-${SpiInstboardname}-spi__${SpiInstbootorder}.bin"' '"${filesize}"'; 
			fatrm '${SpiInstDevType}' 0#SpiInst '"u-boot-${SpiInstref}-${SpiInstboardname}-spi__${SpiInstbootorder}.bin"';
		else; 
			echo '"SPI Installer: spi u-boot install failed"'; 
			fatmkdir '${SpiInstDevType}' 0#SpiInst failure; 
			fatwrite '${SpiInstDevType}' 0#SpiInst '"${loadaddr}"' '"failure/u-boot-${SpiInstref}-${SpiInstboardname}-spi__${SpiInstbootorder}.bin"' '"${filesize}"'; 
			fatrm '${SpiInstDevType}' 0#SpiInst '"u-boot-${SpiInstref}-${SpiInstboardname}-spi__${SpiInstbootorder}.bin"';
		fi; 
	else;
		echo '"SPI Installer: failed to load spi u-boot into memory"'; 
	fi; 
fi; 
|
